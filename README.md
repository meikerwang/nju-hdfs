# 微服务架构的分布式文件系统设计与实现

https://github.com/njuics/sa-2018/wiki/%E8%AF%BE%E7%A8%8B%E5%A4%A7%E4%BD%9C%E4%B8%9A
https://github.com/njuics/sa-2019/wiki/Final-Project

- 基于Spring Boot实现NameNode和DataNode两个服务
- 在Spring Cloud微服务平台上运行一个NameNode实例和多个DataNode实例（无需考虑NameNode单点失效问题）
- NameNode提供REST风格接口与用户交互，实现用户文件上传、下载、删除，DataNode不与用户直接交互（无需考虑NameNode的IO瓶颈问题）
- NameNode将用户上传文件文件拆为固定大小的存储块，分散存储在各个DataNode上，每个块保存若干副本。块大小和副本数可通过系统参数配置。
- DataNode服务可弹性扩展，每次启动一个DataNode服务NameNode可发现并将其纳入整个系统
- NameNode负责检查各DataNode健康状态，需模拟某个DataNode下线时NameNode自动在其他DataNode上复制（迁移）该下线服务原本保存的数据块
- NameNode在管理数据块存储和迁移过程中应实现一定策略尽量保持各DataNode的负载均衡

## 主要技术实现

### Eureka作为服务的注册与发现

Namenode作为注册中心, 负责对DataNode服务的上线,下线,续约进行监听和发现管理

当DataNode服务上线时, 自动的添加到服务集合中, 并且续约的时候也会添加进去

当服务下线时, 会从node集合中移除

并且每次请求来临时, NameNode都会想各个DataNode发送一个拉取所有节点信息的包, 检查网络是否可用, 不可用的话也会进行排除

直到检测到下线时会进行移除


### ribbon负载均衡组件

默认的负载均衡器是简单的轮询, 而我们的分布式文件存储中是进行的基于Block的随机查找进行负载均衡

包括文件的存储, 进行随机的负载

当节点挂了后, 会进行block的备份, 将block数量扩展到3个, 同时也进行负载均衡


### hystrix作为熔断组件

雪崩问题: 某个服务的不可用,会导致请求一直阻塞在那里, 耗尽服务器资源, 会导致依赖于这个服务的其他服务也变得不可用, 进而导致整个系统崩溃,造成系统的雪崩效应

线程隔离: 为每个服务分配线程池, 当线程池已满或者请求超时, 进行服务价降级, 加速失败判定时间而不是进行排队, 返回一个提示信息而不是阻塞在那里无休止的等待

服务降级: 优先保证核心服务, 非核心的服务不可用或者弱可用, 当线程池已满或者请求超时出现

服务熔断: 关闭状态, 半关闭状态, 开启状态
- Hystix会对请求情况计数，当一定时间内失败请求百分比达到阈值，则触发熔断，断路器会完全打开
- open状态不是永久的，打开后会进入休眠时间（默认是5S）。随后断路器会自动进入半开状态。此时会释放部分请求通过，若这些请求都是健康的，则会完全关闭断路器，否则继续保持打开，再次进行休眠计时


feign作为远程调用组件
